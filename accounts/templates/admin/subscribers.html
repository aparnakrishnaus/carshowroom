{% extends "dashboard_base.html" %}
{% block content %}

<style>
 .table-responsive {
        width: 100%;
        overflow-x: auto;
        border-radius: 8px;
        margin-top: 15px;
        -webkit-overflow-scrolling: touch;
    }

    .table {
        width: 100%;
        min-width: 800px;
        border-collapse: collapse;
        background-color: #fff;
        color: #000;
        font-size: 0.88rem;
        border-radius: 10px;
    }

    .table th {
        padding: 12px 10px;
    }

    .table th,
    .table td {
        text-align: left;
        border-bottom: 1px solid #2e2e2e;
        white-space: nowrap;
    }

    .table td {
        padding: 4px 8px;
    }

    .table thead th {
        background-color: #2c2c2c !important;
        font-weight: 500;
        color: #fff;
    }

    .table tbody td {
        color: black !important;
    }
</style>

<div class="container py-4 mt-5">

    <div class="page-header">
        <h2>Subscribers</h2>
         {% include "accounts/_top_icons.html" %}
        <a href="{% url 'admin_dashboard' %}" title="Back to Dashboard"><i class="fa-solid fa-arrow-left"></i></a>
    </div>

     <div class="divider bg-secondary mb-3" style="height:2px;"></div>


 <!-- _____________________ offer __________________ -->
  <h5 class="fw-bold mb-2">Send Offer</h5>

  <div class="card shadow-sm" style="max-width: 600px;">
    <div class="card-body p-3">

      <form method="POST" action="{% url 'send_offer' %}">
        {% csrf_token %}

        <div class="mb-2">
          <input type="text" name="subject" class="form-control form-control-sm" placeholder="Offer Title" required>
        </div>

        <div class="mb-2">
          <textarea name="message" class="form-control form-control-sm" rows="3" placeholder="Offer Message" required></textarea>
        </div>

        <button type="submit" class="btn btn-success btn-sm w-100" id="send-btn" disabled>
    <i class="bi bi-send-fill"></i> Send
</button>


      </form>

    </div>
  </div>
<!-- _____________________ table__________________ -->

<hr>

 <h5 class="fw-bold mb-2">Subscribers</h5>

    <div class="table-responsive mt-4">
  <table class="table table-striped mb-0">
    <thead class="table-dark">
      <tr>
        <th>
          <input type="checkbox" id="select-all">
        </th>
        <th>#</th>
        <th>Username</th>
        <th>Email</th>
        <th>Status</th>
        <th>Subscribed On</th>
         <th>Action</th>
      </tr>
    </thead>

    <tbody>
      {% for s in subscribers %}
      <tr>
        <td>
          <input type="checkbox" class="subscriber-checkbox" name="recipients" value="{{ s.email }}">
        </td>
        <td>{{ forloop.counter }}</td>
        <td>{{ s.user.username }}</td>
        <td>{{ s.email }}</td>
        <td>
          <span class="badge bg-success">Subscribed</span>
        </td>
        <td>{{ s.subscribed_on|date:"d M Y h:i a" }}</td>
           <td>
          <form method="POST" action="{% url 'delete_subscriber' s.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this subscriber?');">
              Delete
            </button>
          </form>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="text-center py-3">No subscribers found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
  </div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
  const selectAll = document.getElementById("select-all");
  const checkboxes = document.querySelectorAll(".subscriber-checkbox");

  selectAll.addEventListener("change", function() {
    checkboxes.forEach(cb => cb.checked = selectAll.checked);
  });

  checkboxes.forEach(cb => {
    cb.addEventListener("change", function() {
      if (!cb.checked) {
        selectAll.checked = false;
      } else {
        selectAll.checked = Array.from(checkboxes).every(c => c.checked);
      }
    });
  });
});
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const selectAll = document.getElementById("select-all");
    const checkboxes = document.querySelectorAll(".subscriber-checkbox");
    const sendBtn = document.getElementById("send-btn");

    function updateSendButton() {
        // Enable if at least one checkbox is checked
        const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
        sendBtn.disabled = !anyChecked;
    }

    // Handle Select All
    selectAll.addEventListener("change", function() {
        checkboxes.forEach(cb => cb.checked = selectAll.checked);
        updateSendButton();
    });

    // Handle individual checkboxes
    checkboxes.forEach(cb => {
        cb.addEventListener("change", function() {
            if (!cb.checked) {
                selectAll.checked = false;
            } else {
                selectAll.checked = Array.from(checkboxes).every(c => c.checked);
            }
            updateSendButton();
        });
    });

    // Initial check on page load
    updateSendButton();
});
</script>


{% endblock %}
